<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—É—Ä–Ω–∏—Ä | CyberTournament Hub</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-gamepad"></i>
                <span>CYBER TOURNAMENT HUB</span>
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i> –ì–ª–∞–≤–Ω–∞—è
                </a>
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i> –ü–∞–Ω–µ–ª—å
                </a>
                <a href="teams.html" class="nav-link">
                    <i class="fas fa-users"></i> –ö–æ–º–∞–Ω–¥—ã
                </a>
                <a href="tournaments.html" class="nav-link active">
                    <i class="fas fa-trophy"></i> –¢—É—Ä–Ω–∏—Ä—ã
                </a>
                <a href="matches.html" class="nav-link">
                    <i class="fas fa-fist-raised"></i> –ú–∞—Ç—á–∏
                </a>
                <a href="rules.html" class="nav-link">
                    <i class="fas fa-book"></i> –ü—Ä–∞–≤–∏–ª–∞
                </a>
                <a href="admin.html" class="nav-link admin-link">
                    <i class="fas fa-shield-alt"></i> –ê–¥–º–∏–Ω
                </a>
            </div>
            <div class="nav-auth">
                <div class="user-info">
                    <span id="currentUser">–ì–æ—Å—Ç—å</span>
                    <button class="btn btn-sm btn-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="back-button">
            <a href="tournaments.html" class="btn">
                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Ç—É—Ä–Ω–∏—Ä–∞–º
            </a>
        </div>

        <div id="tournamentPage" class="tournament-page">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ JS -->
        </div>
    </div>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-gamepad"></i>
                        <h3>CyberTournament Hub</h3>
                    </div>
                    <p class="footer-description">–í–µ–¥—É—â–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤</p>
                    <div class="social-links">
                        <a href="#" class="social-link"><i class="fab fa-vk"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-telegram"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-discord"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h4>
                    <div class="footer-links">
                        <a href="index.html"><i class="fas fa-home"></i> –ì–ª–∞–≤–Ω–∞—è</a>
                        <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
                        <a href="teams.html"><i class="fas fa-users"></i> –ö–æ–º–∞–Ω–¥—ã</a>
                        <a href="tournaments.html"><i class="fas fa-trophy"></i> –¢—É—Ä–Ω–∏—Ä—ã</a>
                        <a href="matches.html"><i class="fas fa-gamepad"></i> –ú–∞—Ç—á–∏</a>
                        <a href="rules.html"><i class="fas fa-book"></i> –ü—Ä–∞–≤–∏–ª–∞</a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>–ò–≥—Ä—ã</h4>
                    <div class="footer-links">
                        <a href="#"><i class="fas fa-crosshairs"></i> Counter-Strike 2</a>
                        <a href="#"><i class="fas fa-fist-raised"></i> Dota 2</a>
                        <a href="#"><i class="fas fa-bullseye"></i> Valorant</a>
                        <a href="#"><i class="fas fa-crown"></i> League of Legends</a>
                        <a href="#"><i class="fas fa-shield-alt"></i> Overwatch 2</a>
                        <a href="#"><i class="fas fa-bolt"></i> Fortnite</a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h4>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>
                    <div class="contact-info">
                        <p><i class="fas fa-envelope"></i> support@cybertournament.ru</p>
                        <p><i class="fas fa-phone"></i> +7 (999) 123-45-67</p>
                        <p><i class="fas fa-map-marker-alt"></i> –ú–æ—Å–∫–≤–∞, —É–ª. –ö–∏–±–µ—Ä—Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è, 15</p>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 CyberTournament Hub. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
                <div class="footer-legal">
                    <a href="privacy.html">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
                    <a href="terms.html">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
                    <a href="cookies.html">–ü–æ–ª–∏—Ç–∏–∫–∞ cookies</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="assets/js/database.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ü–æ–ª—É—á–∞–µ–º ID —Ç—É—Ä–Ω–∏—Ä–∞ –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const tournamentId = urlParams.get('id');
        
        if (!tournamentId) {
            showError('–¢—É—Ä–Ω–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }
        
        loadTournament(tournamentId);
    });

    function loadTournament(tournamentId) {
        const db = new Database();
        const tournament = db.getTournamentFull(tournamentId);
        
        if (!tournament) {
            showError('–¢—É—Ä–Ω–∏—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }
        
        document.title = `${tournament.name} | CyberTournament Hub`;
        
        const container = document.getElementById('tournamentPage');
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Ç—É—Ä–Ω–∏—Ä–∞
        const statusText = tournament.status === 'upcoming' ? '–û–∂–∏–¥–∞–µ—Ç—Å—è' :
                         tournament.status === 'active' ? '–í –ø—Ä–æ—Ü–µ—Å—Å–µ' : '–ó–∞–≤–µ—Ä—à–µ–Ω';
        const statusClass = tournament.status === 'upcoming' ? 'status-upcoming' :
                          tournament.status === 'active' ? 'status-active' : 'status-finished';
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã
        const startDate = formatDate(tournament.startDate);
        const endDate = formatDate(tournament.endDate);
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥
        const prizePoolFormatted = tournament.prizePool ? 
            '$' + tournament.prizePool.toLocaleString() : '–ù–µ —É–∫–∞–∑–∞–Ω';
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ñ–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π
        const matchTypeText = tournament.matchType === 'bo1' ? 'BO1 (–¥–æ 1 –ø–æ–±–µ–¥—ã)' :
                            tournament.matchType === 'bo3' ? 'BO3 (–¥–æ 2 –ø–æ–±–µ–¥)' : 'BO5 (–¥–æ 3 –ø–æ–±–µ–¥)';
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ñ–æ—Ä–º–∞—Ç —Ç—É—Ä–Ω–∏—Ä–∞
        const formatText = tournament.format === 'single' ? '–û–ª–∏–º–ø–∏–π—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞' :
                         tournament.format === 'double' ? '–î–≤–æ–π–Ω–∞—è —ç–ª–∏–º–∏–Ω–∞—Ü–∏—è' : '–ö—Ä—É–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞';
        
        // –°–æ–±–∏—Ä–∞–µ–º HTML
        let html = `
            <div class="tournament-header">
                <h1>${escapeHtml(tournament.name)}</h1>
                <div class="tournament-meta">
                    <div class="tournament-meta-item">
                        <i class="fas fa-gamepad"></i>
                        <span>${tournament.game.toUpperCase()}</span>
                    </div>
                    <div class="tournament-meta-item">
                        <i class="fas fa-calendar"></i>
                        <span>${startDate} - ${endDate}</span>
                    </div>
                    <div class="tournament-meta-item">
                        <i class="fas fa-trophy"></i>
                        <span>–ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥: ${prizePoolFormatted}</span>
                    </div>
                    <div class="tournament-meta-item">
                        <span class="tournament-status ${statusClass}">${statusText}</span>
                    </div>
                </div>
            </div>
        `;
        
        if (tournament.description) {
            html += `
                <div class="card">
                    <h3><i class="fas fa-info-circle"></i> –û–ø–∏—Å–∞–Ω–∏–µ</h3>
                    <p>${escapeHtml(tournament.description).replace(/\n/g, '<br>')}</p>
                    <div class="tournament-details">
                        <p><strong>–§–æ—Ä–º–∞—Ç —Ç—É—Ä–Ω–∏—Ä–∞:</strong> ${formatText}</p>
                        <p><strong>–§–æ—Ä–º–∞—Ç –º–∞—Ç—á–µ–π:</strong> ${matchTypeText}</p>
                        <p><strong>–ú–∞–∫—Å–∏–º—É–º –∫–æ–º–∞–Ω–¥:</strong> ${tournament.maxTeams || '–ù–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ'}</p>
                    </div>
                </div>
            `;
        }
        
        if (tournament.winner) {
            html += `
                <div class="tournament-winner">
                    <div class="winner-crown">üèÜ</div>
                    <h2>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å —Ç—É—Ä–Ω–∏—Ä–∞</h2>
                    <div class="team-info">
                        <h3>${escapeHtml(tournament.winner.name)} ${tournament.winner.tag ? '[' + escapeHtml(tournament.winner.tag) + ']' : ''}</h3>
                        <p>–†–µ–π—Ç–∏–Ω–≥: ${tournament.winner.rating} | –ü–æ–±–µ–¥—ã: ${tournament.winner.wins || 0}</p>
                    </div>
                </div>
            `;
        }
        
        // –£—á–∞—Å—Ç–Ω–∏–∫–∏
        html += `
            <div class="card">
                <h3><i class="fas fa-users"></i> –£—á–∞—Å—Ç–Ω–∏–∫–∏ (${tournament.teams.length})</h3>
                <div class="tournament-teams">
        `;
        
        tournament.teams.forEach(team => {
            const initials = team.tag ? 
                team.tag.substring(0, 2) : 
                team.name.substring(0, 2);
            
            html += `
                <div class="tournament-team-card">
                    <div class="team-logo-placeholder">
                        ${initials.toUpperCase()}
                    </div>
                    <h4>${escapeHtml(team.name)}</h4>
                    ${team.tag ? `<div class="team-tag">${escapeHtml(team.tag)}</div>` : ''}
                    <div class="team-stats">
                        <div class="stat">
                            <div class="stat-value">${team.rating || 1000}</div>
                            <div class="stat-label">–†–µ–π—Ç–∏–Ω–≥</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${team.wins || 0}</div>
                            <div class="stat-label">–ü–æ–±–µ–¥—ã</div>
                        </div>
                    </div>
                </div>
            `;
        });
        
        html += `
                </div>
            </div>
        `;
        
        // –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞
        if (tournament.matches && tournament.matches.length > 0) {
            html += `
                <div class="card">
                    <h3><i class="fas fa-sitemap"></i> –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞</h3>
                    <div class="bracket-section">
            `;
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –º–∞—Ç—á–∏ –ø–æ —Ä–∞—É–Ω–¥–∞–º
            const rounds = {};
            tournament.matches.forEach(match => {
                const round = match.round;
                if (!rounds[round]) rounds[round] = [];
                rounds[round].push(match);
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ä–∞—É–Ω–¥—ã
            const sortedRounds = Object.keys(rounds).sort((a, b) => a - b);
            
            sortedRounds.forEach(roundNumber => {
                const roundName = getRoundName(parseInt(roundNumber));
                
                html += `
                    <div class="round">
                        <div class="round-header">
                            ${roundName}
                        </div>
                `;
                
                rounds[roundNumber].forEach(match => {
                    html += renderMatchItem(match);
                });
                
                html += `</div>`;
            });
            
            html += `
                    </div>
                </div>
            `;
        } else {
            html += `
                <div class="card">
                    <h3><i class="fas fa-sitemap"></i> –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞</h3>
                    <p>–°–µ—Ç–∫–∞ —Ç—É—Ä–Ω–∏—Ä–∞ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥.</p>
                </div>
            `;
        }
        
        container.innerHTML = html;
    }

    function getRoundName(roundNumber) {
        const roundNames = {
            1: '1/8 —Ñ–∏–Ω–∞–ª–∞',
            2: '1/4 —Ñ–∏–Ω–∞–ª–∞',
            3: '1/2 —Ñ–∏–Ω–∞–ª–∞',
            4: '–§–∏–Ω–∞–ª',
            5: '–ì—Ä–∞–Ω–¥-—Ñ–∏–Ω–∞–ª'
        };
        return roundNames[roundNumber] || `–†–∞—É–Ω–¥ ${roundNumber}`;
    }

    function renderMatchItem(match) {
        const statusClass = match.status === 'upcoming' ? 'match-upcoming' :
                          match.status === 'live' ? 'match-live' : 'match-finished';
        const statusText = match.status === 'upcoming' ? '–û–∂–∏–¥–∞–µ—Ç—Å—è' :
                          match.status === 'live' ? '–í –ø—Ä—è–º–æ–º —ç—Ñ–∏—Ä–µ' : '–ó–∞–≤–µ—Ä—à–µ–Ω';
        
        const isTeam1Winner = match.score1 > match.score2;
        const isTeam2Winner = match.score2 > match.score1;
        const matchDate = match.date ? formatDate(match.date) : '–î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';
        
        return `
            <div class="match-item ${isTeam1Winner || isTeam2Winner ? 'winner' : ''}">
                <div class="match-teams">
                    <div class="team-info ${isTeam1Winner ? 'winner-team' : ''}">
                        <div class="team-name">${escapeHtml(match.team1.name)}</div>
                        ${match.team1.tag ? `<div class="team-tag">${escapeHtml(match.team1.tag)}</div>` : ''}
                    </div>
                    <div class="match-vs">VS</div>
                    <div class="team-info ${isTeam2Winner ? 'winner-team' : ''}">
                        <div class="team-name">${escapeHtml(match.team2.name)}</div>
                        ${match.team2.tag ? `<div class="team-tag">${escapeHtml(match.team2.tag)}</div>` : ''}
                    </div>
                </div>
                <div class="match-score">
                    ${match.score1}:${match.score2}
                </div>
                <div class="match-info">
                    <span class="match-status ${statusClass}">${statusText}</span>
                    <span class="match-date">${matchDate}</span>
                </div>
            </div>
        `;
    }

    function showError(message) {
        const container = document.getElementById('tournamentPage');
        container.innerHTML = `
            <div class="error-page">
                <h1><i class="fas fa-exclamation-triangle"></i> ${message}</h1>
                <p>–ó–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –±—ã–ª —É–¥–∞–ª–µ–Ω.</p>
                <a href="tournaments.html" class="btn btn-primary">
                    <i class="fas fa-arrow-left"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç—É—Ä–Ω–∏—Ä–∞–º
                </a>
            </div>
        `;
    }
    </script>
</body>
</html>